// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 質問形式の列挙型
enum QuestionType {
  MULTIPLE_CHOICE  // 複数選択（チェックボックス）
  FREE_TEXT        // 自由記述
}

// 質問
model Question {
  id        Int          @id @default(autoincrement())
  text      String       // 質問文
  type      QuestionType // 質問形式
  order     Int          // 表示順序
  options   Json?        // 選択肢（MULTIPLE_CHOICEの場合のみ、文字列の配列）
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  answers   Answer[]     // この質問への回答
}

// アンケートの提出（1回の回答セット）
model Submission {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  answers   Answer[] // この提出に含まれる回答
}

// 個別の回答
model Answer {
  id           Int        @id @default(autoincrement())
  submissionId Int        // どの提出に属するか
  questionId   Int        // どの質問への回答か
  value        Json       // 回答値（FREE_TEXTの場合は文字列、MULTIPLE_CHOICEの場合は選択された項目の配列）
  createdAt    DateTime   @default(now())

  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  question     Question   @relation(fields: [questionId], references: [id])

  @@index([submissionId])
  @@index([questionId])
}
